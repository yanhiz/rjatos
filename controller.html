<!DOCTYPE html>
<!-- 
// Version 2.0
// 19-11-2025 
-->
<html>
  <head>
    <title>Experiment</title>
    <!-- STIMULI -->
    <script src="stimuli.js"></script>
    <!-- JATOS -->
    <script src="jatos.js"></script>
    <script src="jatos/counter.js"></script>
    <!-- JSPSYCH PLUGINS -->
    <script src="jspsych/jspsych.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@1.2.0"></script>
    <script src="jspsych/plugin-survey-text.js"></script>
    <!-- CSS -->
    <link href="jspsych/jspsych.css" rel="stylesheet" type="text/css" />
  </head>
  <body></body>
  <script>
    
jatos.onLoad(() => {

    var jsPsych = initJsPsych({
      on_finish: () => jatos.endStudy(true,'Controller run')
    });

    var timeline = [];

    var design = make_design(types = [],step = false);

    var screen = {
      type: jsPsychHtmlButtonResponse,
      stimulus : () => {
        var {lists,current_list,cycle,cycle_counter,to_do,store,participant_counter,...rest} = design
        var show_design = ''
        for (key in lists) {
          show_design = show_design.concat(`"${key}" with ${Object.keys(lists[key]).length} conditions, `)
        }
        if (cycle_counter == 0){ var counter_message = `So far, no complete cycle has been done.`} else {
          if (cycle_counter == 1) { var counter_message = `So far, 1 complete cycle has been done.`} else { 
            var counter_message = `So far, ${cycle_counter} complete cycles have been done.`}}
        return `
        <b>Your design is: </b><br>
        ${show_design} which requires <u>${cycle.length} participants</u> for a complete cycle.<br><br>
        The cycle is the following: ${cycle.map((x) => {x = x.toString().replace(',','');return ' '+x})}<br>
        ${counter_message}<br><br>
        The next list will be ${current_list}. <br>
        Currently, ${participant_counter} participants finished the experiment.<br><br>

        
        <u><b>What do you want to do?</b></u>
        <br>
        `
      },
      choices : ['<p style="color:blue;"><b>&#128519;<br>Continue</b></p>','<p style="color:red;"><b> &#128520;<br>Reinitialize<b></p>'],
      on_finish: function(data){
      data.choice = jsPsych.data.get().select('response').values[0]
      if (data.choice == 1){
        jatos.batchSession.clear()
      }
    }
  }
    timeline.push(screen)

   var message = {
      type: jsPsychHtmlButtonResponse,
      stimulus:'<p style="font-size:14pt"> &#128520; Your counters have been reinitialized &#128520;</p>',

      choices:['<p style="color:blue;"><b>&#128519;<br>Continue</b></p>']
   }

    var if_node = {
      timeline: [message],
      conditional_function: function(){
              if (jsPsych.data.get().select('choice').values[0] == 1){
                return true
              } else {
                return false
              }
            }
    }
    timeline.push(if_node)
    



    jsPsych.run(timeline);


});
</script>
</html>